import tkinter as tk
from tkinter import messagebox
import mysql.connector
class categories:
    def __init__(self, category_name="", category_id=0):
        self.category_name=category_name
        self.category_id=category_id
        self.root=tk.Tk()
        self.root.title("catagory section")
        self.frame=tk.Frame(self.root,width=1000,height=1000)
        self.frame.pack()
        self.adding_catagory()
        self.root.mainloop()

    def adding_catagory(self):
        label=tk.Label(self.frame,text="pleas enter the catagory that you want to add")
        label.pack()
        self.add_box=tk.Entry(self.frame,width=50)
        self.add_box.pack()
        subment=tk.Button(self.frame,text="add the catagory",command=self.save_catagory)
        subment.pack()
    def save_catagory(self):
        self.category_name=self.add_box.get()
        if not self.category_name:
            messagebox.showwarning("","please enter the the catagory that you want to add")
            return
        cursor = db.cursor()
        sql = "INSERT INTO categories (category_name) VALUES (%s)"
        cursor.execute(sql, (category_names,))
        cursor.execute("SELECT created_at FROM categories WHERE category_id = LAST_INSERT_ID()")
        created_time = cursor.fetchone()[0]
        db.commit()
        messagebox.showinfo("Success", f"Product added successfully\nCreated At: {created_time}")
    def update_category(self):

        label = tk.Label(self.frame, text="Enter the category ID to update")
        label.pack()

        self.catID = tk.Entry(self.frame, width=50)
        self.catID.pack()

        next_btn = tk.Button(self.frame, text="Next", command=self.open_update_category_window)
        next_btn.pack()

    def open_update_category_window(self):
        category_id = self.catID.get()

        if category_id == "":
            messagebox.showerror("Error", "Please enter the ID")
            return

        self.c_window = tk.Toplevel(self.frame)
        self.c_window.title("Update Category")

        tk.Label(self.c_window, text="Enter new category name:").pack()

        self.newValue = tk.Entry(self.c_window, width=50)
        self.newValue.pack()

        tk.Button(self.c_window, text="Update", command=self.update).pack()

    def update(self):
        category_id = self.catID.get()
        new_value = self.newValue.get()

        if new_value == "":
            messagebox.showerror("Error", "Please enter the new value")
            return

        sql = "UPDATE categories SET category_name=%s WHERE category_id=%s"
        cursor.execute(sql, (new_value, category_id))
        db.commit()

        messagebox.showinfo("Success", "Successfully updated")
        self.c_window.destroy()

    def delete_category(self):
   
       name = tk.simpledialog.askstring("Delete Category", "Enter the category name to delete:")
       if not name:
          messagebox.showerror("Error", "Please enter a category name")
          return

   
       cursor.execute("SELECT category_id FROM categories WHERE category_name=%s", (name,))
       result = cursor.fetchone()
       if not result:
          messagebox.showerror("Error", "Category not found")
          return

       category_id = result[0]

    
       cursor.execute("UPDATE categories SET deleted_at = NOW() WHERE category_id=%s", (category_id,))
       db.commit()

   
       cursor.execute("SELECT deleted_at FROM categories WHERE category_id=%s", (category_id,))
       deleted_time = cursor.fetchone()[0]

       messagebox.showinfo("Deleted", f"Category '{name}' deleted successfully\nDeleted At: {deleted_time}")
